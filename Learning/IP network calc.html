<html>
  <head>
    <title>IP calc</title>
    <meta charset="utf-8">
  </head>
  <body>
    <p>IP address calculator. Insert your host IP address and MAC.</p>
    <input id="IPinput">
    <input id="MACinput">
    <input type="button" onclick="start()" value = "Calculate"><br>
    <p id="result"></p>
  </body>
<script type="text/javascript">
const IPinput = document.getElementById("IPinput");
const MACinput = document.getElementById("MACinput");
const result = document.getElementById("result");
var hostMAC = MACinput.value.split(/[.]/);
var hostIP = IPinput.value.split(/[.]/);
var newElement = document.createElement("P");

function start(){
  hostMAC = MACinput.value.split(/[.]/);
  hostIP = IPinput.value.split(/[.]/);
  if(hostMAC.length == 4){
    fullVer();
  }else{
    brLine("Invalid MAC");
  }
}

function fullVer(){

  var netIP = [], disIP = [], arNetIP = [], arDisIP = [];
  var displayNetIP = '', displayDisIP = '';

  function arrayIP(){
    for(let i = 0;hostIP.length>i;i++){
    hostIP[0+i] = parseInt(hostIP[0+i], 10).toString(2);
    hostIP[0+i] = hostIP[0+i].split('');
    }
    for(i = 0; hostIP.length>i;i++){
      for(let iW = 0; 8-hostIP[0+i].length>iW;){
        hostIP[0+i].unshift(0);
        if(iW > 40){break;}
      }
      if(hostIP[0+i].length==8){console.log(i+1+" done")}
    }
    console.log(hostIP);
  }

  function arrayMAC(){
    for(let i = 0;hostMAC.length>i;i++){
    hostMAC[0+i] = parseInt(hostMAC[0+i], 10).toString(2);
    hostMAC[0+i] = hostMAC[0+i].split('');
    }
    for(i = 0; hostMAC.length>i;i++){
      for(let iW = 0; 8-hostMAC[0+i].length>iW;){
        hostMAC[0+i].unshift(0);
        if(iW > 40){break;}
      }
      if(hostMAC[0+i].length==8){console.log(i+1+" done")}
    }
    console.log(hostMAC);
  }

  arrayIP();
  console.log("Switch");
  arrayMAC();

  console.log("Arrays ready")
  for(i=0;hostIP.length>i;i++){
    netIP[0+i] = new Array(8);
    for(var iW=0;hostIP[0+i].length>iW;iW++){
      netIP[i][iW] = hostIP[i][iW] & hostMAC[i][iW];
    }
    arNetIP[i] = parseInt((netIP[i].join('')), 2);
    displayNetIP += arNetIP[i] + '.';
  }
  console.log(netIP)
  console.log(displayNetIP);

  console.log("break")

  for(i=0;hostIP.length>i;i++){
    disIP[0+i] = new Array(8);
    for(iW=0;hostIP[0+i].length>iW;iW++){
      disIP[i][iW] = netIP[i][iW] + (1 - hostMAC[i][iW]);
    }
    arDisIP[i] = parseInt((disIP[i].join('')), 2);
    displayDisIP += arDisIP[i] + '.';
  }

  brLine("Network address: " + displayNetIP.slice(0, displayNetIP.length-1));
  brLine("Distributing address: " + displayDisIP.slice(0, displayDisIP.length-1));
}
      /*function shortVer(){
        for(i=0;i<hostMAC.length;i++){
          netIP[0+i] = hostIP[0+i] & hostMAC[0+i];
        }
        for(i=0;i<hostMAC.length;i++){
          disIP[0+i] = hostIP[0+i] | ffHostMAC[0+i];
        }
        console.log(disIP)
        var displayNetIP = netIP[0] +"."+netIP[1]+"."+netIP[2]+"."+netIP[3];
        var displayDisIP = disIP[0] +"."+disIP[1]+"."+disIP[2]+"."+disIP[3];
        brLine("Network address: " + displayNetIP);
        brLine("Distributing address: " + displayDisIP);
      }

      else if(hostMAC.length == 1 && hostMAC != !hostMAC && hostMAC[0] <= 32){
          console.log("Number of bits in a mask");
          let nbMAC = hostMAC[0];
          const fc1FullMAC = cFullMAC(32-nbMAC, 32).match(/.{1,8}/g);
          const fc1NotMAC = cNotMAC(32-nbMAC, 32).match(/.{1,8}/g);
          console.log(fc1FullMAC);
          let fullMAC = [], notMAC = [];
          fullMAC[0] = parseInt(fc1FullMAC[0], 2);
          fullMAC[1] = parseInt(fc1FullMAC[1], 2);
          fullMAC[2] = parseInt(fc1FullMAC[2], 2);
          fullMAC[3] = parseInt(fc1FullMAC[3], 2);
          notMAC[0] = parseInt(fc1NotMAC[0], 2);
          notMAC[1] = parseInt(fc1NotMAC[1], 2);
          notMAC[2] = parseInt(fc1NotMAC[2], 2);
          notMAC[3] = parseInt(fc1NotMAC[3], 2);
          console.log(fullMAC);

          for(i=0;i<hostIP.length;i++){
            netIP[0+i] = hostIP[0+i] & fullMAC[0+i];
          }
          for(i=0;i<fullMAC.length;i++){
            disIP[0+i] = hostIP[0+i] | notMAC[0+i];
          }
          console.log(disIP);
          var displayNetIP = netIP[0] +"."+netIP[1]+"."+netIP[2]+"."+netIP[3];
          var displayDisIP = disIP[0] +"."+disIP[1]+"."+disIP[2]+"."+disIP[3];
          brLine("Network address: " + displayNetIP);
          console.log(displayNetIP);
          brLine("Distributing address: " + displayDisIP);
      }
      else{
        console.log("Invalid MAC")
      }

    function cFullMAC(ones, total) {
      var result = (2**total + 2**ones - 1).toString(2).slice(1);
      return flipbits(result);
    }

    function cNotMAC(ones, total) {
      var result = (2**total + 2**ones - 1).toString(2).slice(1);
      return result;
    }

    */
function brLine(aText){
  let newBreak = document.createElement("BR");
  let newText = document.createTextNode(aText);
  newElement.appendChild(newText);
  newElement.appendChild(newBreak);
  result.parentNode.appendChild(newElement);
}

  </script>
</html>
