<html>
  <head>
    <title>IP calc</title>
    <meta charset="utf-8">
  </head>
  <body>
    <p>IP address calculator. Insert your host IP address and MAC.</p>
    <input id="IPinput">
    <input id="MACinput">
    <input type="button" onclick="start()" value = "Calculate"><br>
    <p id="result"></p>
  </body>
  <script type="text/javascript">
    const IPinput = document.getElementById("IPinput");
    const MACinput = document.getElementById("MACinput");
    const result = document.getElementById("result");
    var newElement = document.createElement("P");

    function start(){
      let hostIP = IPinput.value.split(/[.]/);
      let netIP = [0, 0, 0, 0];
      let disIP = [0,0,0,0];
      var hostMAC = MACinput.value.split(/[.]/);

      if(hostMAC.length == 4){
        let fHostMAC = [];
        console.log(hostMAC[3]);
        fHostMAC[0] = flipbits(parseInt(hostMAC[0], 10).toString(2));
        fHostMAC[1] = flipbits(makeup((parseInt(hostMAC[0], 10).toString(2))));
        fHostMAC[2] = flipbits(makeup((parseInt(hostMAC[0], 10).toString(2))));
        fHostMAC[3] = flipbits(parseInt(hostMAC[0], 10).toString(2));
        let ffHostMAC = [];
        console.log(typeof(fHostMAC[3]));
        console.log(5..toString(2));
        console.log(fHostMAC[0])
        function makeup(e){
          var result2 = (2**8 + 2**e - 1).toString(2).slice(1);
          return result2;
        }

        let f2 = makeup(fHostMAC[3]);
        console.log(f2);

        ffHostMAC[0] = parseInt(fHostMAC[0], 2);
        ffHostMAC[1] = parseInt(fHostMAC[1], 2);
        ffHostMAC[2] = parseInt(fHostMAC[2], 2);
        ffHostMAC[3] = flipbits(parseInt(fHostMAC[3], 2));

        console.log(typeof(fHostMAC[3]));
        console.log(ffHostMAC[3]);

        for(i=0;i<hostMAC.length;i++){
          netIP[0+i] = hostIP[0+i] & hostMAC[0+i];
        }
        for(i=0;i<hostMAC.length;i++){
          disIP[0+i] = hostIP[0+i] | ffHostMAC[0+i];
        }
        console.log(disIP)
        var displayNetIP = netIP[0] +"."+netIP[1]+"."+netIP[2]+"."+netIP[3];
        var displayDisIP = disIP[0] +"."+disIP[1]+"."+disIP[2]+"."+disIP[3];
        brLine("Network address: " + displayNetIP);
        brLine("Distributing address: " + displayDisIP);
      }

      else if(hostMAC.length == 1 && hostMAC != !hostMAC && hostMAC[0] <= 32){
          console.log("Number of bits in a mask");
          let nbMAC = hostMAC[0];
          const fc1FullMAC = cFullMAC(32-nbMAC, 32).match(/.{1,8}/g);
          const fc1NotMAC = cNotMAC(32-nbMAC, 32).match(/.{1,8}/g);
          console.log(fc1FullMAC);
          let fullMAC = [], notMAC = [];
          fullMAC[0] = parseInt(fc1FullMAC[0], 2);
          fullMAC[1] = parseInt(fc1FullMAC[1], 2);
          fullMAC[2] = parseInt(fc1FullMAC[2], 2);
          fullMAC[3] = parseInt(fc1FullMAC[3], 2);
          notMAC[0] = parseInt(fc1NotMAC[0], 2);
          notMAC[1] = parseInt(fc1NotMAC[1], 2);
          notMAC[2] = parseInt(fc1NotMAC[2], 2);
          notMAC[3] = parseInt(fc1NotMAC[3], 2);
          console.log(fullMAC);

          for(i=0;i<hostIP.length;i++){
            netIP[0+i] = hostIP[0+i] & fullMAC[0+i];
          }
          for(i=0;i<fullMAC.length;i++){
            disIP[0+i] = hostIP[0+i] | notMAC[0+i];
          }
          console.log(disIP);
          var displayNetIP = netIP[0] +"."+netIP[1]+"."+netIP[2]+"."+netIP[3];
          var displayDisIP = disIP[0] +"."+disIP[1]+"."+disIP[2]+"."+disIP[3];
          brLine("Network address: " + displayNetIP);
          console.log(displayNetIP);
          brLine("Distributing address: " + displayDisIP);
      }
      else{
        console.log("Invalid MAC");
      }
    }

    function cFullMAC(ones, total) {
      var result = (2**total + 2**ones - 1).toString(2).slice(1);
      return flipbits(result);
    }

    function cNotMAC(ones, total) {
      var result = (2**total + 2**ones - 1).toString(2).slice(1);
      return result;
    }

    function flipbits(str) {
      str = str.toString(2);
      console.log(str);
      return str.split('').map(function (b) {
        return (1 - b).toString();
      }).join('');
    }

    function brLine(aText){
      let newBreak = document.createElement("BR");
      let newText = document.createTextNode(aText);
      newElement.appendChild(newText);
      newElement.appendChild(newBreak);
      result.parentNode.appendChild(newElement);
    }

  </script>
</html>
